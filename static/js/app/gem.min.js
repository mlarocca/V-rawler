var ALPHA_R=Math.PI/3,ALPHA_0=Math.PI,SIGMA_R,SIGMA_0=1/3,INITIAL_T=50,MIN_T=0.001,MAX_T=256,GRAV_CONSTANT=0.0625,onmessage=startGEM;function startGEM(e){e=e.data;GEM(e.graph,e.max_rounds,e.viewWidth,e.viewHeight,e.DISTURBANCE_RANGE,e.DESIRED_EDGE_LENGTH_SQUARED)}
function GEM(e,C,D,E,y,r){var z,A=[],s,l=e.length,h,p=[],t=[],w=[],x=[],u=Array(l),B=function(){var c,a;if(z<=MIN_T||s>=C)postMessage({stop:!0});else{s+=1;c=u;var b,f;for(b=1;b<l;b++)a=Math.floor(Math.random()*b),f=c[b],c[b]=c[a],c[a]=f;u=c;for(c=0;c<l;c++){a=u[c];b=e[a];f=a;var k=h,d=e[f],m=(Math.random()-0.5)*y.x,n=(Math.random()-0.5)*y.y,q=void 0,g=void 0,F=d.edges.length;a={x:0,y:0};var v=g=void 0,g=GRAV_CONSTANT*x[f]*d.size;a.x=(k.x-d.x)*g;a.y=(k.y-d.y)*g;if(d.x<=d.radius||d.x+d.radius>=D)a.x*=
4;if(d.y<=d.radius||d.y+d.radius>=E)a.y*=4;a.x+=m;a.y+=n;for(q=0;q<l;q++)q!==f&&(g=e[q],m=d.x-g.x,n=d.y-g.y,0!==m||0!==n)&&(v=m*m+n*n,g=d.size*g.size/v,a.x+=m*r.x*g,a.y+=n*r.y*g);for(q=0;q<F;q++)g=e[d.edges[q]],m=d.x-g.x,n=d.y-g.y,v=m*m+n*n,g=v/x[f],a.x-=m/r.x*g,a.y-=n/r.y*g;f=b;b=a;d=void 0;a=f.index;k=w[a];d=void 0;if(0!==b.x||0!==b.y)d=Math.sqrt(b.x*b.x+b.y*b.y),b.x*=p[a]/d,b.y*=p[a]/d,f.x+=b.x,f.y+=b.y,h.x+=b.x/l,h.y+=b.y/l;if(0!==k.x||0!==k.y)d=Math.acos((b.x*k.x+b.y*k.y)/Math.sqrt(b.x*b.x+b.y*
b.y)/Math.sqrt(k.x*k.x+k.y*k.y)),f=Math.sin(d),k=Math.cos(d),f>Math.sin(Math.PI+ALPHA_R/2)&&(t[a]+=SIGMA_R*f?0>f?-1:1:0),Math.abs(k)>Math.cos(ALPHA_0/2)&&(p[a]=p[a]*SIGMA_0*k),p[a]*=1-t[a],p[a]=Math.min(p[a],MAX_T),w[a]=b}for(c=0;c<l;c++)A[c]={x:e[c].x,y:e[c].y};postMessage(A);B()}};(function(){var c,a;s=0;z=INITIAL_T;SIGMA_R=0.5/l;h={x:0,y:0};for(c=0;c<l;c++)a=e[c],h.x+=a.x,h.y+=a.y,p[c]=INITIAL_T,t[c]=0,w[c]={x:0,y:0},x[c]=1+a.edges.length/2,u[c]=c;h.x/=l;h.y/=l})();B()};